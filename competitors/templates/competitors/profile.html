<!DOCTYPE html>
<html lang="en" ng-app="competitorsApp">
<head>
    <title>Your Profile</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}competitors/css/base.css">
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}competitors/css/person.css">
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}competitors/css/profile.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <!-- For Icons -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src="{{STATIC_URL}}competitors/js/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.13/angular.min.js"></script>

</head>
<body ng-controller="profile">
    <div id="header">
        {% include 'competitors/navbar.html' %}
        {% csrf_token %}
    </div>
    <div id="body" style="height:1200px;">
    
        {% for error in errors %}
        <h4 style="color: red">
            {{ error }}
        </h4>
        {% endfor %}
        <!-- Image Upload html starts/ Please replace them with <img-upload></img-upload>-->
        <div class="modal fade" id="imgbox">
            <div class="modal-dialog" style="width:80%;">
                <div class="modal-content" >
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Change Ur Image</h4>
                    </div>
                    <div class="modal-body" style="padding:0 0; margin:15px 15px;";>
                        <div id="log" class="row">
                            <div class="col-md-8" style="padding-left:0">
                                <canvas id="imageCanvas" >
                                </canvas>
                                <div id="drag">
                                </div>
                                <div id="drag1">
                                </div>
                                <div id="drag2">
                                </div>
                                <div id="drag3">
                                </div>
                                <div id="drag4">
                                </div>
                            </div>
                            <div class="col-md-4" style="padding:0;">
                                <canvas id="imageCanvas2"></canvas>
                                <input type="hidden" name="data" id="img_url" value=""/>
                                {% csrf_token %}
                                <button id="upload" ng-click="save()" class="btn btn-default">Upload</button>
                                <div id="hint">
                                    <h4>Drag mouse to change the range of your image</h4>
                                </div>
                            </div>
                        </div>
                        <div id="instruction">
                                <label>
                                    Image File:
                                </label>
                                <input type="file" id="imageLoader" name="imageLoader" size="60" value=="Select Your Image"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Image Upload html ends. Please replace them with <img-upload></img-upload>-->


        <div class="col-sm-12 col-md-5" id="left-wrapper">
            <div id="img-wrapper">
                <img  src="{{currentUser.img_url}}" width="190px" ng-click="" ng-mouseover="hoverIn()" ng-mouseleave="hoverOut()" data-toggle="modal" data-target="#imgbox"/>
            </div>
            <div class="text-center" id="left-text">
                <h4>{{currentUser.user.username}}</h4>
            </div>

                
            <div class="panel panel-default col-md-offset-2 col-md-8 cp-profile-nav">
                <div class="panel-body row ">
                    <div class="col-xs-4 col-sm-4 col-md-4 cp-profile-nav-content" ng-click="personalshow=true;favoriteshow=false;friendsshow=false;">
                        <a href="javascript:;" ng-class="{'cp-proflie-nav-content-active':personalshow}">Personal</a>
                    </div>
                    <div class="col-xs-4 col-sm-4 col-md-4 cp-profile-nav-content" ng-click="personalshow=false;favoriteshow=true;friendsshow=false;">
                        <a href="javascript:;" ng-class="{'cp-proflie-nav-content-active':favoriteshow}">Favorite</a>
                    </div>
                    <div class="col-xs-4 col-sm-4 col-md-4 cp-profile-nav-content" ng-click="personalshow=false;favoriteshow=false;friendsshow=true;">
                        <a href="javascript:;" ng-class="{'cp-proflie-nav-content-active':friendsshow}">Friends</a>
                    </div>
                </div>
            </div>

<!--             <ul class="nav nav-pills nav-justified" style="border:none;font-color:white">
                <li role="presentation" ng-class="{'active':personalshow}" class="col-xs-4 col-sm-4 col-md-4" style="padding-left:0;padding-right:0;font-color:white" ng-click="personalshow=true;favoriteshow=false;friendsshow=false;"><a href="#">Personal</a></li>
                <li role="presentation" ng-class="{'active':favoriteshow}" class="col-xs-4 col-sm-4 col-md-4" style="padding-left:0;padding-right:0;font-color:white" ng-click="personalshow=false;favoriteshow=true;friendsshow=false;"><a href="#">Favorite</a></li>
                <li role="presentation" ng-class="{'active':friendsshow}"class="col-xs-4 col-sm-4 col-md-4" style="padding-left:0;padding-right:0;font-color:white" ng-click="personalshow=false;favoriteshow=false;friendsshow=true;"><a href="#">Friends</a></li>
            </ul> -->





<!--             <div class="text-center" id="left-text">
                <h4>{{currentUser.user.username}}</h4>
                <br>
                <p>2015.6.10 Singed in</p>
                <p>Position</p>
                <br>
                <p>Personal Slogan:</p>
            </div> -->
        </div>
        



        <div class="col-sm-12 col-md-7" id="right-wrapper">
            <div class="" id="personal" ng-show="personalshow">
                <ul class="nav nav-tabs" id="tabs">
                    <li role="presentation" class="active"><a href="#tab-1"><span class="glyphicon glyphicon-user" aria-hidden="true"></a></li>
                    <li role="presentation"><a href="#tab-2"><span class="glyphicon glyphicon-star" aria-hidden="true"></a></li>
                    <li role="presentation"><a href="#tab-3"><span class="glyphicon glyphicon-time" aria-hidden="true"></a></li>
                </ul>
                <br/>
                <div class="tab-content">
                    <div class="tab-pane cp-profile-pane active" id="tab-1">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Essential Info &nbsp;&nbsp;&nbsp;
                                <a ng-show="!edit" href="javascript:;" ng-click="edit=!edit" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                                <a ng-show="edit" href="javascript:;" ng-click="edit=!edit" class="glyphicon glyphicon-floppy-save" aria-hidden="true"></a>  
                                
                            </div>
                            
                            <div class="text-left panel-body">
                                <form class="form-horizontal">
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-2 control-label cp-profile-form-label">Username</label>
                                        <div class="col-sm-9">
                                            <p class="form-control-static" ng-show="!edit">{{currentUser.user.username}}</p>
                                            <input ng-show="edit" type="email" class="form-control input" value="{{currentUser.user.username}}" id="inputEmail3" placeholder="Email">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputPassword3" class="col-sm-2 control-label cp-profile-form-label">Firstname</label>
                                        <div class="col-sm-9">
                                            <p class="form-control-static" ng-show="!edit">{{currentUser.user.first_name}}</p>
                                            <input type="password" ng-show="edit" class="form-control" value="{{currentUser.user.first_name}}" id="inputPassword3" placeholder="Password">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputPassword3" class="col-sm-2 control-label cp-profile-form-label">Lastname</label>
                                        <div class="col-sm-9">
                                            <p class="form-control-static" ng-show="!edit">{{currentUser.user.last_name}}</p>
                                            <input type="password" ng-show="edit" value="{{currentUser.user.last_name}}" class="form-control" id="inputPassword3" placeholder="Password">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputPassword3" class="col-sm-2 control-label cp-profile-form-label">Birthday</label>
                                        <div class="col-sm-9">
                                            <p class="form-control-static" ng-show="!edit">{{currentUser.user.username}}</p>
                                            <input type="date" ng-show="edit" class="form-control" id="inputPassword3" placeholder="Password">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="panel panel-default">
                            <div class="panel-heading"> 
                                Contact Info &nbsp;&nbsp;&nbsp;                                
                                <a ng-show="!edit" href="javascript:;" ng-click="edit=!edit" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                                <a ng-show="edit" href="javascript:;" ng-click="edit=!edit" class="glyphicon glyphicon-floppy-save" aria-hidden="true"></a>  
                            </div>
                            <div class="panel-body text-left">
                                <form class="form-horizontal">
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-3 control-label cp-profile-form-label"><p><i class="fa fa-envelope-o fa-fw"></i> Email</p></label>
                                        <div class="col-sm-9">
                                            <p class="form-control-static" ng-show="!edit">{{currentUser.user.username}}</p>
                                            <input ng-show="edit" type="email" class="form-control input" value="{{currentUser.user.username}}" id="inputEmail3" placeholder="Email">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-3 control-label cp-profile-form-label"><p><i class="fa fa-facebook-official fa-fw"></i> Facebook</p></label>
                                        <div class="col-sm-9">
                                            <p class="form-control-static" ng-show="!edit">{{currentUser.user.username}}</p>
                                            <input ng-show="edit" type="email" class="form-control input" value="{{currentUser.user.username}}" id="inputEmail3" placeholder="Email">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-3 control-label cp-profile-form-label"><p><i class="fa fa-twitter fa-fw"></i> Twitter</p></label>
                                        <div class="col-sm-9">
                                            <p class="form-control-static" ng-show="!edit">{{currentUser.user.username}}</p>
                                            <input ng-show="edit" type="email" class="form-control input" value="{{currentUser.user.username}}" id="inputEmail3" placeholder="Email">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputEmail3" class="col-sm-3 control-label cp-profile-form-label"><p><i class="fa fa-instagram fa-fw"></i> Intsagram</p></label>
                                        <div class="col-sm-9">
                                            <p class="form-control-static" ng-show="!edit">{{currentUser.user.username}}</p>
                                            <input ng-show="edit" type="email" class="form-control input" value="{{currentUser.user.username}}" id="inputEmail3" placeholder="Email">
                                        </div>
                                    </div>

                                </form>
                     <!--            <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Email: </p>
                                <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Blog: </p>
                                <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Facebook: </p>
                                <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Instagram: </p>
                                <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Twitter: </p>
                                <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  MSN: </p> -->
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="tab-2">asd</div>
                    <div class="tab-pane" id="tab-3">123</div>
                </div>     
            </div>
            <div class="" id="favorite" ng-show="favoriteshow">
                <ul class="nav nav-tabs" id="tabs">
                    <li role="presentation" class="active"><a href="#tab-21"><span class="glyphicon glyphicon-user" aria-hidden="true">Favorite Teams</a></li>
                    <li role="presentation"><a href="#tab-22"><span class="glyphicon glyphicon-star" aria-hidden="true">Favorite Players</a></li>
                </ul>
                <br/>
                <div class="tab-content">  
                    <div class="tab-pane active cp-profile-pane" id="tab-21">
                        {% for team in teamfollows %}
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    {{team.name}}
                                </div>
                                <div class="panel-body row">
                                    <div class="col-sm-3">
                                        <img style="width:100%;" src="{{team.icon_url}}"/>
                                    </div>
                                    <div class="col-sm-9">
                                        {{team.followers.count}}
                                    </div>
                                </div>
                               
                            </div>
                        {% endfor %}
                    </div>
                    <div class="tab-pane cp-profile-pane" id="tab-22">
                        {% for player in playerfollows %}
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    {{player.name}}
                                </div>
                                <div class="panel-body row">
                                    <div class="col-sm-3">
                                        <img style="width:100%;" src="{{player.icon_url}}"/>
                                    </div>
                                    <div class="col-sm-9">
                                        {{player.followers.count}}
                                    </div>
                                </div>
                               
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="" id="friends" ng-show="friendsshow">
                axxx 
            </div>
<!--             <ul class="nav nav-tabs" id="tabs">
                <li role="presentation" class="active"><a href="#tab-1"><span class="glyphicon glyphicon-user" aria-hidden="true"></a></li>
                <li role="presentation"><a href="#tab-2"><span class="glyphicon glyphicon-star" aria-hidden="true"></a></li>
                <li role="presentation"><a href="#tab-3"><span class="glyphicon glyphicon-time" aria-hidden="true"></a></li>
            </ul>           
            <div class="tab-content">
                <div id="tab-1">
                    <h4>Essential Info &nbsp;&nbsp;&nbsp;
                        <a class="glyphicon glyphicon-pencil" aria-hidden="true"></a> 
                    </h4>
                    <hr>
                    <div class="text-left">
                        <p>Username: </p>
                        <p>First Name: </p>
                        <p>Last Name: </p>
                        <p>Age: </p>
                        <p>Location: </p>
                        <p>Registration Time:</p>
                    </div>
                    <h4>Contact Info &nbsp;&nbsp;&nbsp;
                        <a class="glyphicon glyphicon-pencil" aria-hidden="true"></a> 
                    </h4>
                    <hr>
                    <div class="text-left">
                        <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Email: </p>
                        <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Blog: </p>
                        <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Facebook: </p>
                        <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Instagram: </p>
                        <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  Twitter: </p>
                        <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>  MSN: </p>
                    </div>
                </div>
                <div id="tab-2">asd</div>
                <div id="tab-3">123</div>
            </div> -->
        </div>

<!--         <div id="info" class="panel">

             <div id="image" >
                <img src="{{currentUser.img_url}}" width="150px"/>

            </div>

            <div id="personal">
                <div id="mainpanelbody" class="panel">
                    <h4>Username: {{currentUser.user.username}}</h4>
                    <h4>Fisrtname: {{currentUser.user.first_name}}</h4>
                    <h4>Last Name: {{currentUser.user.last_name}}</h4>
                    <h4>Age: {{currentUser.age}}</h4>
                </div>
            </div>
            <div id="bio">
                 <h4>Bio:</h4>
                 <p>{{currentUser.bio}}</p>
                {% if currentUser.user.username = user.username %}
                     <a href="{% url 'edit' %}">Edit Profile</a>
                {% endif %}
            </div>
        </div> -->

<!--         <div class="personal_follows">
            {% for team in teamfollows %}

                <div class="recommend_each">
                    <a href="{% url 'team_page' team.id %}">
                        <div class="panel">
                            <div class="recommend_each_img">
                                <img src="{{team.icon_url}}"/>
                            </div>
                            <div class="recommend_each_info">
                                <h6>{{team.name}}</h6>
                                <h6>{{team.followers.count}}</h6>
                            </div>
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>
        <div class="personal_follows">
            {% for player in playerfollows %}

                <div class="recommend_each">
                    <a href="{% url 'player_page' player.id %}">
                        <div class="panel">
                            <div class="recommend_each_img">
                                <img src="{{player.icon_url}}"/>
                            </div>
                            <div class="recommend_each_info">
                                <h6>{{player.name}}</h6>
                                <h6>{{player.followers.count}}</h6>
                            </div>
                        </div>
                    </a>
                </div>
            {% endfor %}-->
        </div> 
    {% include 'competitors/footer.html' %}
</body>
<script src="{{STATIC_URL}}competitors/js/app.js"></script>

<script type="text/javascript" src="{{STATIC_URL}}competitors/js/controllers/login.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}competitors/js/base.js"></script>
<script src="{{STATIC_URL}}competitors/js/directives/imgUpload.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}competitors/js/controllers/login.js"></script>
<script src="{{STATIC_URL}}competitors/js/directives/login_pop.js"></script>
<!-- <script type="text/javascript" src="{{STATIC_URL}}competitors/js/profile.js"></script> -->
<script type="text/javascript">
competitorsApp.controller('profile',['$scope', function($scope){
    $scope.edit = false;
    $scope.personalshow = true;
    $scope.favoriteshow =false;
    $scope.friendsshow =false;
    {% if currentUser.user.username = user.username %}
        $scope.self = true;
    {% endif %}
    $scope.hoverIn = function(){
        console.log(13);
    }

    $scope.hoverOut = function(){
        console.log(325);
    }

    $scope.save = function(){
        console.log(6666);
        var file = $("#img_url").attr('value')
        $.ajax({
            type: "post",
            url: "/save_pic",
            data: {
                'userAdjustedImage': file,
                'csrfmiddlewaretoken': token,
                },

            enctype: 'multipart/form-data',
            success: function() {
                alert("success")
                location.reload(true)
            },
            error: function() {
                    alert("Oh no! There seems to have been some problem with the picture you uploaded");
                  },
        })
    }

// Image Upload js starts

function canvasarea(){
    $("#instruction").css("display","block")
}


var imageLoader = document.getElementById('imageLoader');
    imageLoader.addEventListener('change', handleImage, false);
var canvas = document.getElementById('imageCanvas');
var canvas2 = document.getElementById('imageCanvas2');
var ctx = canvas.getContext('2d');
var ctx2 = canvas2.getContext('2d');
var len = 500;
var source = "";
function handleImage(e){
    

    var reader = new FileReader();
    reader.onload = function(event){
        var img = new Image();
        
        img.onload = function(){
            var ratio = img.height/img.width;
            var reduce = img.height/500;
            canvas.width = 500/ratio;
            canvas.height = 500;
            canvas2.width = 200;
            canvas2.height = 200;
            len = canvas.width;
            $("#drag2").width(canvas.width-$("#drag").width()+"px");
            ctx.drawImage(img,0,0,500/ratio,500);
            ctx2.drawImage(img,0,0,100*reduce,100*reduce,0,0,200,200);
            $("#img_url").attr('value',canvas2.toDataURL('image/png').replace("data:image/png;base64,", ""));
        }
        img.src = event.target.result;
        source = img.src;
        
    }
    
    reader.readAsDataURL(e.target.files[0]); 
    $("#log").css("display","block");    
}
function generate(x,y,w,h){
    
    var img2 = new Image();
    img2.onload = function(){
        var ratio = img2.height/img2.width;
        var reduce = img2.height/500;
        canvas.width = 500/ratio;
        canvas.height = 500;
        len = canvas.width;
        canvas2.width = 200;
        canvas2.height = 200;
        ctx.drawImage(img2,0,0,500/ratio,500);
        console.log(x+ " "+ y+ " "+w+" "+h);
        ctx2.drawImage(img2,x*reduce,y*reduce,w*reduce,h*reduce,0,0,200,200);
    }
    if (source!=""){
        img2.src = source;
    }
    $("#img_url").attr('value',canvas2.toDataURL('image/png').replace("data:image/png;base64,", ""));
}


  

    var state = 0;
    var down = false;
    var x = 0;
    var y = 0;
    $(document).mousedown(function( d){
                down = true;
                // console.log(down);


    });
    $(document).mouseup(function(){
            down = false;
            state = 0;
            // console.log(down);
    });
    $("#log").mousemove(function(e){
        
        console.log(len)
        $('html,body').css('cursor','default');
        var vertical="";
        var horizontal="";
        var position = $("#drag").position();
        var width = $("#drag").width();
        var height = $("#drag").height();
       var parentOffset = $(this).parent().offset(); 
       var top = position.top;
        var left = position.left;
       // console.log(e.pageX+ " "+e.pageY);
       // console.log(parentOffset.left+ " "+parentOffset.top);
       var relX = e.pageX - parentOffset.left;
       var relY = e.pageY - parentOffset.top;
       // console.log(relX+ " "+relY);
       // console.log(top+ " "+left);
       if (down == true)
            change(state,relX,relY);
       
       if (Math.abs(top-relY)<5 && relX>=left && relX<=left+width){
            vertical = 'top';
            if (down == false)
                state = 1; 
            
        }
       if (Math.abs(top+height-relY)<5 && relX>=left && relX<=left+width){
            vertical = 'bottom';
            if (down == false)
                state = 2; 
            
        }
       if (Math.abs(left-relX)<5 && relY>=top && relY<=top+height){
            horizontal = "left";
            if (down == false)
                state = 1; 
            
        }
       if (Math.abs(left+width-relX)<5 && relY>=top && relY<=top+height){
            horizontal = "right";
            if (down == false)
                state = 2; 
            
           } 
        if (relX<=left+width-5 && relX>=left+5 && relY>=top+5 && relY<=top+height-5){
            if (down == false)
                state = 3;
            $('html,body').css('cursor','all-scroll');
          
        }
        if ((vertical == 'top' && horizontal == 'left') || (vertical == 'bottom' && horizontal == 'right'))
            $('html,body').css('cursor','nwse-resize');
        else if (vertical == 'top'|| vertical == 'bottom')
            $('html,body').css('cursor','ns-resize');
        else if (horizontal == 'left'|| horizontal == 'right')
            $('html,body').css('cursor','ew-resize');
        x = relX;
        y = relY;

    });
    function change(state,relX,relY){
       
        if (state == 1 ){
            
            var vtop = parseInt($("#drag3").height());
            var hleft= parseInt($("#drag1").width());
            var width = parseInt($("#drag").width());
            var height = parseInt($("#drag").height());
            var speedx = relX-x;
            var speedy = relY-y;
            var speed = Math.max(Math.abs(speedx),Math.abs(speedy));
            if (speedx<=0 && speedy<=0){
                speed = -speed;
            }else if (speedx>=0 && speedy>=0){
                speed = speed;
            }else{
                speed = 0;
            }
            var min = Math.min(vtop+height,hleft+width);
            newwidth= Math.min(Math.max(50,width-speed),min);
            newheight = Math.min(Math.max(50,height-speed),min);
            $("#drag").width(parseInt(newwidth)+"px");
            $("#drag").height(parseInt(newheight)+"px");
            $("#drag1").width(parseInt(hleft+width-newwidth)+"px");
            $("#drag3").height(parseInt(vtop+height-newheight)+"px");
            $("#drag").css("top",parseInt($("#drag3").height()) + "px");
            $("#drag").css("left",parseInt($("#drag1").width()) + "px");
            $("#drag3").css("left",parseInt($("#drag1").width()) + "px");
            $("#drag4").css("left",parseInt($("#drag1").width()) + "px");
            $("#drag3").width(parseInt($("#drag").width()) + "px");
            $("#drag4").width(parseInt($("#drag").width()) + "px");
        }
        if (state == 2 ){
            
            var vtop = parseInt($("#drag3").height());
            var hleft= parseInt($("#drag1").width());
            var width = parseInt($("#drag").width());
            var height = parseInt($("#drag").height());
            var speedx = relX-x;
            var speedy = relY-y;
            var speed = Math.max(Math.abs(speedx),Math.abs(speedy));
            if (speedx<=0 && speedy<=0){
                speed = -speed;
            }else if (speedx>=0 && speedy>=0){
                speed = speed;
            }else{
                speed = 0;
            }
            var min = Math.min(500-vtop,len-hleft);
            // console.log(height+speed);
            newwidth= Math.min(Math.max(50,width+speed),min);
            newheight = Math.min(Math.max(50,height+speed),min);
            $("#drag").width(parseInt(newwidth)+"px");
            $("#drag").height(parseInt(newheight)+"px");
            $("#drag3").width($("#drag").width());
            $("#drag4").width($("#drag").width());
            $("#drag2").css("left",newwidth+hleft + "px");
            $("#drag2").width(len-newwidth-hleft + "px");
            $("#drag4").css("top",newheight+vtop + "px");
            $("#drag4").height(500-newheight-vtop + "px");
        }
        if (state == 3){
            var vtop=0;
            var hleft=0;
            var width = parseInt($("#drag").width());
            var height = parseInt($("#drag").height());
            if (parseInt($("#drag3").height())+relY-y+height>500)
                vtop = 500-height;
            else if (parseInt($("#drag").css("top"))+relY-y<0)
                vtop = 0;
            else
                vtop = parseInt($("#drag").css("top"))+relY-y;

            if (parseInt($("#drag1").width())+relX-x+width>len)
                hleft = len-width;
            else if (parseInt($("#drag").css("left"))+relX-x<0)
                hleft = 0;
            else
                hleft = parseInt($("#drag").css("left"))+relX-x;

            // console.log(vtop);
            // console.log(hleft);
            $("#drag").css("top",vtop + "px");
            $("#drag").css("left",hleft + "px");
            $("#drag1").width(hleft+"px");
            $("#drag2").width((len-hleft-width)+"px");
            $("#drag2").css("left",(hleft+width) + "px");
            $("#drag3").height(vtop+"px");
            $("#drag3").css("left",hleft + "px");
            $("#drag4").height((500-vtop-height)+"px");
            $("#drag4").css("top",(vtop+height) + "px");
            $("#drag4").css("left",hleft + "px");
        }
        var hleft= parseInt($("#drag").css("left"));
        var vtop = parseInt($("#drag").css("top"));
        var width = parseInt($("#drag").width());
        var height = parseInt($("#drag").height());
        generate(hleft,vtop,width,height);
    }

    var token = $('input[name="csrfmiddlewaretoken"]').prop('value');
    function save_pic(){
        console.log(name)
        var file = $("#img_url").attr('value')
            $.ajax({
                type: "post",
                url: "/save_pic",
                data: {
                    'userAdjustedImage': file,
                    'csrfmiddlewaretoken': token,
                    },

                enctype: 'multipart/form-data',

                success: function() {
                         location.reload(true)
                     },
                error: function() {
                        alert("Oh no! There seems to have been some problem with the picture you uploaded");
                      },
            })
    }

// Image Upload js ends




}])
    $('#tabs').click(function(e) {
        $('#tabs .active').removeClass('active');
        $(e.target).parents().addClass('active');
    });

    $("#tabs a").click(function (e) {
        $(this).tab('show');
    });

    $('.glyphicon-pencil').click(function(e) {
    });
    function save_pic(){
    console.log(name)
    var file = $("#img_url").attr('value')
        $.ajax({
            type: "post",
            url: "/save_pic",
            data: {
                'userAdjustedImage': file,
                'csrfmiddlewaretoken': token,
                },

            enctype: 'multipart/form-data',

            success: function() {
                alert("Yea");
                     location.reload(true)
                 },
            error: function(e) {
                    alert(e);
                  },
        })
}
</script>
</html>
